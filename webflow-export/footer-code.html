  <script>
    // Updated with 2025 AI Agent research
    const calculatorData = {
      propertyType: null,
      propertySize: null,
      selectedSolutions: [],
      metrics: {
        emailsPerDay: 100,
        staffHours: 40,
        hourlyRate: 15,
        rooms: 50,
        averageRoomRate: 100,
        occupancyRate: 70
      }
    };

    let currentStep = 1;
    let waterfallChart = null;
    let donutChart = null;

    // AI-powered hospitality automation solutions
    const solutions = {
      hotel: [
        {
          id: 'ai-concierge',
          name: 'AI Concierge Chatbot',
          type: 'conversion',
          savings: 250,
          desc: '24/7 multilingual assistant via WhatsApp, website, kiosk',
          metrics: ['rooms', 'occupancyRate'],
          whatItDoes: '24/7 multilingual guest assistant via WhatsApp, website, or in-room kiosk handling check-in questions, FAQs, booking requests, room upgrades, and local recommendations',
          howItHelps: 'Increases upsell revenue by 250% through intelligent, timely recommendations powered by natural language processing and machine learning',
          realWorld: 'Properties using advanced AI messaging report 250% increase in upsell revenue through intelligent recommendations at optimal moments',
          stats: [
            { value: '250%', label: 'Upsell Revenue' },
            { value: '24/7', label: 'Multilingual' }
          ]
        },
        {
          id: 'smart-checkin',
          name: 'Smart Check-in & Check-out',
          type: 'time',
          savings: 78,
          desc: 'ID verification, digital keys, contactless payment',
          metrics: ['staffHours'],
          whatItDoes: 'Automated ID verification, digital room keys via mobile app, and contactless payment processing - guests check in on their phone and go straight to their room',
          howItHelps: 'Reduces front desk time by 78% through fully automated check-in/check-out process with computer vision ID verification and digital key distribution',
          realWorld: 'Hotels report 78% reduction in front desk time through contactless check-in automation, allowing staff to focus on guest service',
          stats: [
            { value: '78%', label: 'Time Saved' },
            { value: 'Contactless', label: 'Digital Keys' }
          ]
        },
        {
          id: 'custom-automation',
          name: 'Custom Business Automation',
          type: 'time',
          savings: 60,
          desc: 'Process mapping, PMS integration, workflow bots',
          metrics: ['staffHours'],
          whatItDoes: 'Custom automation solutions tailored to your specific business needs - we map your current processes, identify automation opportunities, and build custom integrations with your PMS, CRM, POS, accounting, and other systems',
          howItHelps: 'Saves 60% of time on manual workflows through custom automation that connects to your existing systems (Opera, Cloudbeds, Mews) and builds specialized workflow bots for your unique business needs',
          realWorld: 'Businesses implementing custom process-mapped automation report 60% reduction in manual workflows with seamless integration across all their existing systems',
          stats: [
            { value: '60%', label: 'Time Saved' },
            { value: 'Process Map', label: 'Included' }
          ]
        },
        {
          id: 'dynamic-pricing',
          name: 'Dynamic Pricing Automation',
          type: 'revenue',
          savings: 22,
          desc: 'Real-time rates based on 80+ data points',
          metrics: ['rooms', 'averageRoomRate', 'occupancyRate'],
          whatItDoes: 'AI continuously analyzes 80+ data points (occupancy, demand, competitor rates, events, weather) to optimize pricing in real-time across all channels',
          howItHelps: 'Achieves 22% RevPAR improvement through machine learning-powered price optimization that maximizes revenue while maintaining optimal occupancy',
          realWorld: 'Marriott achieved 22% RevPAR improvement using AI revenue management analyzing 80+ data points in real-time',
          stats: [
            { value: '22%', label: 'RevPAR Boost' },
            { value: '80+', label: 'Data Points' }
          ]
        },
        {
          id: 'ai-upselling',
          name: 'Automated Upselling System',
          type: 'conversion',
          savings: 180,
          desc: 'AI suggests upgrades at optimal times',
          metrics: ['rooms', 'occupancyRate'],
          whatItDoes: 'Machine learning identifies best moments to offer upsells (room upgrades, spa packages, late checkout) via email, chatbot, or app notification',
          howItHelps: 'Increases ancillary revenue by 180% through AI-timed upsell offers that reach guests when they\'re most likely to convert',
          realWorld: 'Hotels report 180% increase in ancillary revenue through AI-powered upselling at optimal moments in the guest journey',
          stats: [
            { value: '180%', label: 'Ancillary Revenue' },
            { value: 'AI-timed', label: 'Offers' }
          ]
        },
        {
          id: 'ai-dashboard',
          name: 'AI Analytics Dashboard',
          type: 'time',
          savings: 65,
          desc: 'Real-time KPIs, occupancy, revenue, guest satisfaction',
          metrics: ['staffHours'],
          whatItDoes: 'AI-powered dashboard displaying real-time KPIs: occupancy rates, revenue metrics, guest satisfaction scores, booking trends, and predictive forecasting for demand and staffing needs',
          howItHelps: 'Saves 65% of time on manual reporting while providing instant data visibility and AI-driven insights for better decision-making',
          realWorld: 'Hotels report 65% reduction in reporting time with AI dashboards providing real-time visibility and predictive analytics for revenue optimization',
          stats: [
            { value: '65%', label: 'Time Saved' },
            { value: 'Real-time', label: 'AI Insights' }
          ]
        },
        {
          id: 'omnichannel-hub',
          name: 'Omnichannel Communication Hub',
          type: 'time',
          savings: 82,
          desc: 'AI email automation, WhatsApp, Messenger, SMS, sentiment analysis',
          metrics: ['emailsPerDay', 'staffHours'],
          whatItDoes: 'AI-powered platform centralizing ALL guest communications (email, WhatsApp, Messenger, SMS) with automated responses, intelligent routing, and sentiment analysis that flags negative feedback immediately',
          howItHelps: 'Handles 82% of guest communications automatically with <1 minute response time, AI sentiment analysis for proactive issue resolution, and unified inbox across all channels',
          realWorld: 'Properties report 82% of communications handled by AI with sub-1-minute response times, sentiment analysis preventing negative reviews',
          stats: [
            { value: '82%', label: 'Automated' },
            { value: '<1min', label: 'AI Response' }
          ]
        },
        {
          id: 'custom-ai-software',
          name: 'ðŸŽ¯ Custom AI Software',
          type: 'custom',
          savings: 0,
          desc: 'Tell us what unique challenge you need solved - we build bespoke AI solutions',
          metrics: [],
          whatItDoes: 'Have a specific business challenge or unique workflow that needs automation? We build custom AI software tailored to your exact requirements - from specialized booking systems to predictive analytics dashboards.',
          howItHelps: 'Get a bespoke AI solution designed specifically for your business needs. We analyze your processes, design the perfect system, and build custom software that integrates seamlessly with your existing tools.',
          realWorld: 'Custom AI solutions deliver 3-5x ROI by solving unique business challenges that off-the-shelf software cannot address.',
          stats: [
            { value: '100%', label: 'Tailored' },
            { value: 'Bespoke', label: 'Built for You' }
          ],
          isCustom: true
        }
      ],
      resort: [
        {
          id: 'ai-concierge-resort',
          name: 'AI Concierge Chatbot',
          type: 'conversion',
          savings: 250,
          desc: '24/7 multi-venue assistant for spa, dining, activities',
          metrics: ['rooms', 'occupancyRate'],
          whatItDoes: '24/7 multilingual AI chatbot handling complex multi-venue reservations (spa, dining, activities, rooms) via WhatsApp, website, or kiosk with intelligent cross-selling',
          howItHelps: 'Increases upsell revenue by 250% across all resort amenities through AI-powered recommendations and seamless multi-venue booking',
          realWorld: 'Resorts using conversational AI report 250% upsell increase across all amenities through intelligent, context-aware recommendations',
          stats: [
            { value: '250%', label: 'Upsell Boost' },
            { value: 'Multi-venue', label: 'AI Agent' }
          ]
        },
        {
          id: 'personalized-itinerary',
          name: 'Personalized Itinerary Builder',
          type: 'conversion',
          savings: 180,
          desc: 'AI curates activities based on preferences and weather',
          metrics: ['rooms', 'occupancyRate'],
          whatItDoes: 'AI analyzes guest profile, weather, and availability to create personalized daily itineraries with on-site and nearby activities, complete with booking links',
          howItHelps: 'Increases activity bookings by 180% through AI-generated personalized itineraries that match guest interests and conditions',
          realWorld: 'Resorts report 180% increase in activity bookings through machine learning-powered personalized itinerary recommendations',
          stats: [
            { value: '180%', label: 'More Bookings' },
            { value: 'AI-curated', label: 'Personalized' }
          ]
        },
        {
          id: 'multi-venue-booking-ai',
          name: 'Multi-Venue Booking Sync',
          type: 'time',
          savings: 75,
          desc: 'AI coordinates spa, restaurant, golf, activities',
          metrics: ['staffHours'],
          whatItDoes: 'Central AI system manages availability across all resort venues, prevents double-bookings, resolves conflicts, and optimizes schedules automatically',
          howItHelps: 'Reduces booking coordination time by 75% through AI-powered conflict resolution and automated scheduling across all venues',
          realWorld: 'Resorts achieve 75% reduction in booking coordination with AI managing multi-venue availability and conflict prevention',
          stats: [
            { value: '75%', label: 'Time Saved' },
            { value: 'AI Conflict', label: 'Resolution' }
          ]
        },
        {
          id: 'dynamic-pricing-resort',
          name: 'Dynamic Pricing (All Venues)',
          type: 'revenue',
          savings: 22,
          desc: 'AI pricing for rooms, spa, dining, activities',
          metrics: ['rooms', 'averageRoomRate', 'occupancyRate'],
          whatItDoes: 'Real-time AI price optimization across ALL revenue centers (rooms, spa, dining, activities) using 80+ data points including demand, weather, events',
          howItHelps: 'Achieves 22% RevPAR improvement plus 15% ancillary revenue increase through machine learning pricing across all venues',
          realWorld: 'Resorts report 22% RevPAR boost and 15% ancillary revenue growth with AI dynamic pricing across all revenue centers',
          stats: [
            { value: '22%', label: 'RevPAR Up' },
            { value: 'All Venues', label: 'AI Pricing' }
          ]
        },
        {
          id: 'custom-automation-resort',
          name: 'Custom Business Automation',
          type: 'time',
          savings: 60,
          desc: 'Process mapping, multi-venue PMS integration, workflow bots',
          metrics: ['staffHours'],
          whatItDoes: 'Custom AI automation tailored for resorts - process mapping across multiple venues, PMS integration (Opera, Cloudbeds, Mews), CRM, POS, and accounting system connections with specialized workflow bots',
          howItHelps: 'Saves 60% of time on manual workflows through custom multi-venue automation with API connections to all existing systems',
          realWorld: 'Resorts implementing custom process-mapped automation report 60% reduction in cross-departmental workflows with seamless API integration',
          stats: [
            { value: '60%', label: 'Time Saved' },
            { value: 'API', label: 'Integration' }
          ]
        },
        {
          id: 'ai-marketing-campaigns',
          name: 'AI Marketing Campaigns',
          type: 'conversion',
          savings: 120,
          desc: 'Automated email/SMS for offers, birthdays, re-engagement',
          metrics: ['rooms', 'occupancyRate'],
          whatItDoes: 'AI triggers personalized email/SMS campaigns based on guest behavior: abandoned bookings, special offers, birthdays, post-stay re-engagement',
          howItHelps: 'Increases conversion by 120% through AI-powered campaign timing and personalization based on guest lifecycle and behavior',
          realWorld: 'Resorts report 120% conversion increase from AI-triggered, personalized marketing campaigns sent at optimal moments',
          stats: [
            { value: '120%', label: 'Conversion Up' },
            { value: 'AI-triggered', label: 'Personalized' }
          ]
        },
        {
          id: 'ai-dashboard-resort',
          name: 'AI Analytics Dashboard',
          type: 'time',
          savings: 65,
          desc: 'Real-time multi-venue KPIs, revenue, forecasting',
          metrics: ['staffHours'],
          whatItDoes: 'AI-powered dashboard with real-time KPIs across all venues: occupancy, revenue by department (rooms, spa, F&B, activities), guest satisfaction, and predictive demand forecasting',
          howItHelps: 'Saves 65% of time on manual reporting while providing instant visibility and AI-driven insights for multi-venue revenue optimization',
          realWorld: 'Resorts report 65% reduction in reporting time with AI dashboards providing real-time multi-venue analytics and predictive insights',
          stats: [
            { value: '65%', label: 'Time Saved' },
            { value: 'Multi-venue', label: 'AI Analytics' }
          ]
        },
        {
          id: 'custom-ai-software-resort',
          name: 'ðŸŽ¯ Custom AI Software',
          type: 'custom',
          savings: 0,
          desc: 'Tell us what unique challenge you need solved - we build bespoke AI solutions',
          metrics: [],
          whatItDoes: 'Have a specific business challenge or unique workflow that needs automation? We build custom AI software tailored to your exact requirements - from specialized booking systems to predictive analytics dashboards.',
          howItHelps: 'Get a bespoke AI solution designed specifically for your business needs. We analyze your processes, design the perfect system, and build custom software that integrates seamlessly with your existing tools.',
          realWorld: 'Custom AI solutions deliver 3-5x ROI by solving unique business challenges that off-the-shelf software cannot address.',
          stats: [
            { value: '100%', label: 'Tailored' },
            { value: 'Bespoke', label: 'Built for You' }
          ],
          isCustom: true
        }
      ],
      campsite: [
        {
          id: 'ai-booking-assistant',
          name: 'AI Booking Assistant',
          type: 'conversion',
          savings: 28,
          desc: '24/7 chatbot for pitch selection, policies, special requests',
          metrics: ['rooms', 'occupancyRate'],
          whatItDoes: '24/7 AI chatbot guides guests through booking process, answers pitch availability questions, explains pet policies, handles special requests, and manages complex multi-night reservations',
          howItHelps: 'Increases booking conversion by 28% especially during off-hours through conversational AI that guides guests to completion',
          realWorld: 'Campsites report 28% increase in booking conversion with AI assistants handling after-hours inquiries and complex questions',
          stats: [
            { value: '28%', label: 'Conversion Up' },
            { value: '24/7', label: 'AI Chatbot' }
          ]
        },
        {
          id: 'ai-dashboard-campsite',
          name: 'AI Analytics Dashboard',
          type: 'time',
          savings: 65,
          desc: 'Real-time occupancy, revenue, weather data, booking trends',
          metrics: ['staffHours'],
          whatItDoes: 'AI-powered dashboard displaying real-time KPIs: pitch occupancy rates, revenue metrics, weather impact analysis, booking trends, and predictive forecasting for seasonal demand',
          howItHelps: 'Saves 65% of time on manual reporting while providing instant data visibility and AI insights for weather-based pricing and occupancy optimization',
          realWorld: 'Campsites report 65% reduction in reporting time with AI dashboards providing real-time visibility and weather-based predictive analytics',
          stats: [
            { value: '65%', label: 'Time Saved' },
            { value: 'Weather', label: 'Analytics' }
          ]
        },
        {
          id: 'smart-checkin-campsite',
          name: 'Smart Check-in Automation',
          type: 'time',
          savings: 78,
          desc: 'Digital check-in with GPS, pitch maps, facility codes',
          metrics: ['staffHours'],
          whatItDoes: 'Mobile app check-in with AI sending personalized GPS directions, pitch-specific maps, facility access codes, and campsite information for contactless arrivals',
          howItHelps: 'Reduces check-in processing time by 78% allowing fully contactless arrivals with automated personalized directions',
          realWorld: 'Campsites report 78% reduction in check-in time with smart automation enabling contactless arrivals',
          stats: [
            { value: '78%', label: 'Time Saved' },
            { value: 'Contactless', label: 'Digital' }
          ]
        },
        {
          id: 'dynamic-pricing-campsite',
          name: 'Dynamic Pricing by Weather',
          type: 'revenue',
          savings: 18,
          desc: 'AI adjusts pricing based on weather forecasts, events',
          metrics: ['rooms', 'averageRoomRate', 'occupancyRate'],
          whatItDoes: 'AI adjusts pitch pricing based on weather forecasts (raises rates for sunny weekends, adjusts for rain), local events, school holidays, and booking pace',
          howItHelps: 'Achieves 18% revenue increase through intelligent weather-based pricing optimization that maximizes revenue in peak conditions',
          realWorld: 'Campsites report 18% revenue increase through AI dynamic pricing based on weather patterns and demand signals',
          stats: [
            { value: '18%', label: 'Revenue Up' },
            { value: 'Weather AI', label: 'Pricing' }
          ]
        },
        {
          id: 'automated-guest-comms',
          name: 'Automated Guest Communications',
          type: 'time',
          savings: 70,
          desc: 'AI email automation: weather alerts, pre-arrival, post-stay',
          metrics: ['staffHours'],
          whatItDoes: 'AI-powered triggered email/SMS sequences: weather alerts and safety tips, pre-arrival information, arrival day details, pitch-specific guidelines, local recommendations, and post-stay follow-up',
          howItHelps: 'Reduces repetitive communication by 70% through AI-personalized automated sequences with weather monitoring and pitch-specific content',
          realWorld: 'Campsites report 70% reduction in communication tasks with AI-powered automated messaging including weather alerts',
          stats: [
            { value: '70%', label: 'Time Saved' },
            { value: 'Weather', label: 'Alerts' }
          ]
        },
        {
          id: 'payment-booking-mgmt',
          name: 'Payment & Booking Management',
          type: 'time',
          savings: 55,
          desc: 'AI payment reminders, deposit tracking, API integrations',
          metrics: ['staffHours'],
          whatItDoes: 'AI tracks payment schedules, sends automated reminders, updates booking systems automatically, integrates with payment gateways and accounting software via API',
          howItHelps: 'Reduces payment management time by 55% with faster collection through AI tracking and automated reminders with API integrations',
          realWorld: 'Campsites report 55% less time chasing payments with AI-powered tracking and API-connected payment management',
          stats: [
            { value: '55%', label: 'Time Saved' },
            { value: 'API', label: 'Connected' }
          ]
        },
        {
          id: 'channel-sync-campsite',
          name: 'Channel Sync & Distribution',
          type: 'revenue',
          savings: 15,
          desc: 'AI manages Pitchup, Booking.com, Airbnb, own site',
          metrics: ['rooms', 'occupancyRate'],
          whatItDoes: 'AI manages real-time availability and pricing sync across Pitchup, Booking.com, Airbnb, and own website - prevents double-bookings and optimizes distribution',
          howItHelps: 'Achieves 15% revenue increase from better distribution and zero double-bookings through AI-powered channel management',
          realWorld: 'Campsites report 15% revenue increase with AI channel management preventing double-bookings and optimizing distribution',
          stats: [
            { value: '15%', label: 'Revenue Up' },
            { value: 'Zero', label: 'Double Books' }
          ]
        },
        {
          id: 'custom-ai-software-campsite',
          name: 'ðŸŽ¯ Custom AI Software',
          type: 'custom',
          savings: 0,
          desc: 'Tell us what unique challenge you need solved - we build bespoke AI solutions',
          metrics: [],
          whatItDoes: 'Have a specific business challenge or unique workflow that needs automation? We build custom AI software tailored to your exact requirements - from specialized booking systems to predictive analytics dashboards.',
          howItHelps: 'Get a bespoke AI solution designed specifically for your business needs. We analyze your processes, design the perfect system, and build custom software that integrates seamlessly with your existing tools.',
          realWorld: 'Custom AI solutions deliver 3-5x ROI by solving unique business challenges that off-the-shelf software cannot address.',
          stats: [
            { value: '100%', label: 'Tailored' },
            { value: 'Bespoke', label: 'Built for You' }
          ],
          isCustom: true
        }
      ],
      agency: [
        {
          id: 'ai-travel-agent',
          name: 'AI Travel Agent',
          type: 'conversion',
          savings: 40,
          desc: 'Conversational AI in 15+ languages, 24/7 inquiries',
          metrics: ['staffHours'],
          whatItDoes: 'Conversational AI handles complex travel inquiries in 15+ languages with natural two-way conversations, multi-destination planning, group bookings, available 24/7',
          howItHelps: 'Increases conversion by 40% with Â£150k month 1 revenue (HotelPlanner case) through AI handling after-hours and complex inquiries',
          realWorld: 'HotelPlanner generated Â£150k in month 1 with AI travel agent, achieving 40% conversion increase through 24/7 multilingual support',
          stats: [
            { value: '40%', label: 'Conversion Up' },
            { value: '15+', label: 'Languages' }
          ]
        },
        {
          id: 'smart-quote-generator',
          name: 'Smart Quote Generator',
          type: 'time',
          savings: 70,
          desc: 'AI-powered quotes with dynamic pricing, margin optimization',
          metrics: ['staffHours'],
          whatItDoes: 'AI analyzes client requirements, searches inventory across suppliers, generates optimal quotes with dynamic pricing and margin optimization',
          howItHelps: 'Achieves 70% faster quote generation with 20% better margins through AI-powered pricing and package optimization',
          realWorld: 'Agencies report 70% faster quotes with 20% better margins using AI-powered quote generation and pricing optimization',
          stats: [
            { value: '70%', label: 'Faster' },
            { value: '+20%', label: 'Margins' }
          ]
        },
        {
          id: 'automated-itinerary-builder',
          name: 'Automated Itinerary Builder',
          type: 'time',
          savings: 75,
          desc: 'AI creates multi-day itineraries with optimal routing',
          metrics: ['staffHours'],
          whatItDoes: 'AI creates personalized multi-day itineraries considering preferences, logistics, travel time, and experiences with optimal routing and timing',
          howItHelps: 'Saves 75% time on itinerary creation while producing more detailed, optimized travel plans than manual methods',
          realWorld: 'Agencies report 75% time saved on itinerary creation with AI generating more detailed, optimized multi-day plans',
          stats: [
            { value: '75%', label: 'Time Saved' },
            { value: 'AI-optimized', label: 'Routing' }
          ]
        },
        {
          id: 'client-segmentation-crm',
          name: 'Client Segmentation & CRM',
          type: 'conversion',
          savings: 120,
          desc: 'AI groups clients, API sync to CRM, personalized offers',
          metrics: ['staffHours'],
          whatItDoes: 'AI automatically captures data from emails/calls, groups clients by preferences/spending/behavior, syncs to CRM via API, triggers personalized campaigns',
          howItHelps: 'Increases repeat bookings by 120% through intelligent AI segmentation with API-connected CRM and automated campaigns',
          realWorld: 'Agencies report 120% increase in repeat bookings through AI-powered client segmentation with CRM API integration',
          stats: [
            { value: '120%', label: 'Repeat Bookings' },
            { value: 'API', label: 'Connected' }
          ]
        },
        {
          id: 'email-sms-campaigns',
          name: 'Email & SMS Campaign Automation',
          type: 'conversion',
          savings: 30,
          desc: 'AI email automation: follow-ups, abandoned quotes, reviews',
          metrics: ['staffHours'],
          whatItDoes: 'AI triggers automated email/SMS sequences at optimal times: quote follow-ups (Day 3, Day 7), abandoned booking recovery, post-trip reviews, personalized content',
          howItHelps: 'Increases quote-to-booking conversion by 30% through AI-timed automated follow-ups and personalized campaign sequences',
          realWorld: 'Agencies report 30% conversion increase with AI-powered automated follow-up sequences sent at optimal moments',
          stats: [
            { value: '30%', label: 'Conversion Up' },
            { value: 'AI-timed', label: 'Campaigns' }
          ]
        },
        {
          id: 'dynamic-package-pricing',
          name: 'Dynamic Package Pricing',
          type: 'revenue',
          savings: 20,
          desc: 'AI optimizes pricing by demand, seasonality, competitors',
          metrics: ['staffHours'],
          whatItDoes: 'AI optimizes package pricing in real-time based on demand, seasonality, competitor rates, and margin targets - balances competitiveness with profitability',
          howItHelps: 'Achieves 20% margin improvement while maintaining competitive positioning through AI-powered dynamic pricing',
          realWorld: 'Agencies report 20% margin improvement with AI dynamic pricing maintaining competitiveness while optimizing profitability',
          stats: [
            { value: '20%', label: 'Margin Up' },
            { value: 'AI Dynamic', label: 'Pricing' }
          ]
        },
        {
          id: 'ai-dashboard-agency',
          name: 'AI Analytics Dashboard',
          type: 'time',
          savings: 65,
          desc: 'Real-time KPIs: bookings, revenue, conversion, client insights',
          metrics: ['staffHours'],
          whatItDoes: 'AI-powered dashboard with real-time KPIs: booking pipeline, revenue by destination/client, conversion rates, quote-to-booking ratios, and predictive client lifetime value analytics',
          howItHelps: 'Saves 65% of time on manual reporting while providing instant visibility and AI-driven insights for sales optimization and client targeting',
          realWorld: 'Travel agencies report 65% reduction in reporting time with AI dashboards providing real-time sales analytics and predictive client insights',
          stats: [
            { value: '65%', label: 'Time Saved' },
            { value: 'Predictive', label: 'Analytics' }
          ]
        },
        {
          id: 'custom-ai-software-agency',
          name: 'ðŸŽ¯ Custom AI Software',
          type: 'custom',
          savings: 0,
          desc: 'Tell us what unique challenge you need solved - we build bespoke AI solutions',
          metrics: [],
          whatItDoes: 'Have a specific business challenge or unique workflow that needs automation? We build custom AI software tailored to your exact requirements - from specialized booking systems to predictive analytics dashboards.',
          howItHelps: 'Get a bespoke AI solution designed specifically for your business needs. We analyze your processes, design the perfect system, and build custom software that integrates seamlessly with your existing tools.',
          realWorld: 'Custom AI solutions deliver 3-5x ROI by solving unique business challenges that off-the-shelf software cannot address.',
          stats: [
            { value: '100%', label: 'Tailored' },
            { value: 'Bespoke', label: 'Built for You' }
          ],
          isCustom: true
        }
      ]
    };

    const metricConfigs = {
      emailsPerDay: { label: 'Emails received per day', min: 20, max: 500, step: 10, default: 100, format: (v) => v },
      staffHours: { label: 'Staff hours per week on operations', min: 5, max: 200, step: 5, default: 40, format: (v) => v + ' hrs' },
      hourlyRate: { label: 'Average staff hourly rate', min: 10, max: 50, step: 1, default: 15, format: (v) => 'Â£' + v },
      rooms: { label: 'Number of rooms/units/pitches', min: 5, max: 500, step: 5, default: 50, format: (v) => v + ' units' },
      averageRoomRate: { label: 'Average room rate per night', min: 30, max: 500, step: 10, default: 100, format: (v) => 'Â£' + v },
      occupancyRate: { label: 'Current occupancy rate', min: 30, max: 100, step: 5, default: 70, format: (v) => v + '%' }
    };

    document.addEventListener('DOMContentLoaded', () => {
      setupPropertyCards();
      updateProgress();
    });

    function startCalculator() {
      const overlay = document.getElementById('introOverlay');
      overlay.classList.add('hidden');

      // Remove overlay from DOM after animation completes
      setTimeout(() => {
        overlay.style.display = 'none';
      }, 600);
    }

    function setupPropertyCards() {
      document.querySelectorAll('.property-card').forEach(card => {
        card.addEventListener('click', function() {
          const type = this.dataset.type;
          const size = this.dataset.size;
          if (type) {
            document.querySelectorAll('[data-type]').forEach(c => c.classList.remove('selected'));
            this.classList.add('selected');
            calculatorData.propertyType = type;
          }
          if (size) {
            document.querySelectorAll('[data-size]').forEach(c => c.classList.remove('selected'));
            this.classList.add('selected');
            calculatorData.propertySize = size;
          }
        });
      });
    }

    function populateSolutions() {
      const grid = document.getElementById('solutionsGrid');
      grid.innerHTML = '';
      const propertySolutions = solutions[calculatorData.propertyType] || [];

      propertySolutions.forEach(solution => {
        const card = document.createElement('div');
        card.className = 'solution-card';
        card.dataset.id = solution.id;

        const badgeClass = solution.type === 'time' ? 'badge-time' :
                           solution.type === 'revenue' ? 'badge-revenue' : 'badge-conversion';
        const badgeLabel = solution.type === 'time' ? 'Time Saved' :
                          solution.type === 'revenue' ? 'Revenue' : 'Conversion';

        // Create tooltip HTML if detailed info exists
        const tooltipHTML = solution.whatItDoes ? `
          <div class="tooltip-card">
            <div class="tooltip-title">${solution.name}</div>
            <div class="tooltip-section">
              <div class="tooltip-heading">What It Does</div>
              <div class="tooltip-text">${solution.whatItDoes}</div>
            </div>
            <div class="tooltip-section">
              <div class="tooltip-heading">How It Helps</div>
              <div class="tooltip-text">${solution.howItHelps}</div>
            </div>
            <div class="tooltip-section">
              <div class="tooltip-heading">Real-World Impact</div>
              <div class="tooltip-text">${solution.realWorld}</div>
            </div>
            ${solution.stats ? `
              <div class="tooltip-stats">
                ${solution.stats.map(stat => `
                  <div class="tooltip-stat">
                    <div class="tooltip-stat-value">${stat.value}</div>
                    <div class="tooltip-stat-label">${stat.label}</div>
                  </div>
                `).join('')}
              </div>
            ` : ''}
          </div>
        ` : '';

        card.innerHTML = `
          ${solution.whatItDoes ? '<div class="info-icon"><i class="fa-solid fa-info"></i></div>' : ''}
          <div class="solution-title">${solution.name}</div>
          <div class="solution-desc">${solution.desc}</div>
          <div class="solution-badge ${badgeClass}">${solution.savings}% ${badgeLabel}</div>
          ${tooltipHTML}
        `;

        card.addEventListener('click', function(e) {
          // Don't toggle if clicking on info icon or tooltip
          if (!e.target.closest('.info-icon') && !e.target.closest('.tooltip-card')) {
            this.classList.toggle('selected');
            toggleSolution(solution);
          }
        });

        // Add hover event to position tooltip dynamically
        if (solution.whatItDoes) {
          card.addEventListener('mouseenter', function() {
            const tooltip = this.querySelector('.tooltip-card');
            if (tooltip) {
              positionTooltip(this, tooltip);
            }
          });
        }

        grid.appendChild(card);
      });
    }

    function positionTooltip(card, tooltip) {
      const cardRect = card.getBoundingClientRect();
      const tooltipWidth = 320;
      const tooltipHeight = 400; // Increased for safety
      const spaceAbove = cardRect.top;
      const spaceBelow = window.innerHeight - cardRect.bottom;
      const gap = 15;

      // Calculate horizontal center position
      const cardCenterX = cardRect.left + (cardRect.width / 2);
      const tooltipLeft = cardCenterX - (tooltipWidth / 2);

      // Ensure tooltip doesn't go off screen horizontally
      const minLeft = 10;
      const maxLeft = window.innerWidth - tooltipWidth - 10;
      const finalLeft = Math.max(minLeft, Math.min(tooltipLeft, maxLeft));

      // Decide if tooltip should go above or below
      if (spaceAbove > tooltipHeight + gap || spaceAbove > spaceBelow) {
        // Position above the card
        tooltip.classList.add('tooltip-above');
        tooltip.classList.remove('tooltip-below');
        tooltip.style.left = finalLeft + 'px';
        tooltip.style.top = (cardRect.top - tooltipHeight - gap) + 'px';
        tooltip.style.bottom = 'auto';
      } else {
        // Position below the card
        tooltip.classList.add('tooltip-below');
        tooltip.classList.remove('tooltip-above');
        tooltip.style.left = finalLeft + 'px';
        tooltip.style.top = (cardRect.bottom + gap) + 'px';
        tooltip.style.bottom = 'auto';
      }
    }

    function toggleSolution(solution) {
      // If custom software is selected, go to inquiry form immediately
      if (solution.isCustom) {
        currentStep = 5;
        showStep(currentStep);
        return;
      }

      const index = calculatorData.selectedSolutions.findIndex(s => s.id === solution.id);
      if (index > -1) {
        calculatorData.selectedSolutions.splice(index, 1);
      } else {
        calculatorData.selectedSolutions.push(solution);
      }
    }

    function goBackFromCustom() {
      currentStep = 2;
      showStep(currentStep);
    }

    function submitCustomInquiry(event) {
      event.preventDefault();

      // Get form elements
      const fullNameEl = document.getElementById('fullName');
      const companyNameEl = document.getElementById('companyName');
      const emailEl = document.getElementById('email');
      const phoneEl = document.getElementById('phone');
      const businessChallengeEl = document.getElementById('businessChallenge');

      // Validate required fields
      if (!fullNameEl || !fullNameEl.value.trim()) {
        showValidationError('Please enter your full name');
        fullNameEl?.focus();
        return;
      }

      if (!companyNameEl || !companyNameEl.value.trim()) {
        showValidationError('Please enter your company name');
        companyNameEl?.focus();
        return;
      }

      if (!emailEl || !emailEl.value.trim()) {
        showValidationError('Please enter your email address');
        emailEl?.focus();
        return;
      }

      // Validate email format
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(emailEl.value.trim())) {
        showValidationError('Please enter a valid email address');
        emailEl?.focus();
        return;
      }

      if (!businessChallengeEl || !businessChallengeEl.value.trim()) {
        showValidationError('Please describe your business challenge');
        businessChallengeEl?.focus();
        return;
      }

      // Sanitize and collect form data
      const formData = {
        fullName: sanitizeInput(fullNameEl.value),
        companyName: sanitizeInput(companyNameEl.value),
        email: sanitizeInput(emailEl.value),
        phone: sanitizeInput(phoneEl?.value || ''),
        businessChallenge: sanitizeInput(businessChallengeEl.value),
        currentSystems: sanitizeInput(document.getElementById('currentSystems')?.value || ''),
        desiredOutcome: sanitizeInput(document.getElementById('desiredOutcome')?.value || ''),
        timeline: document.getElementById('timeline')?.value || '',
        budget: document.getElementById('budget')?.value || '',
        propertyType: calculatorData.propertyType,
        propertySize: calculatorData.propertySize,
        timestamp: new Date().toISOString()
      };

      // Log to console (in production, send to your backend/CRM)
      console.log('Custom Software Inquiry:', formData);

      // In production, send to your backend:
      // fetch('/api/custom-inquiry', {
      //   method: 'POST',
      //   headers: { 'Content-Type': 'application/json' },
      //   body: JSON.stringify(formData)
      // })
      // .then(response => response.json())
      // .then(data => {
      //   currentStep = 6;
      //   showStep(currentStep);
      // })
      // .catch(error => {
      //   console.error('Error submitting inquiry:', error);
      //   showValidationError('Failed to submit inquiry. Please try again.');
      // });

      // Go to thank you page
      currentStep = 6;
      showStep(currentStep);
    }

    // Sanitize user input to prevent XSS
    function sanitizeInput(input) {
      if (typeof input !== 'string') return '';

      const div = document.createElement('div');
      div.textContent = input;
      return div.innerHTML.trim();
    }

    function populateSliders() {
      const container = document.getElementById('slidersContainer');
      container.innerHTML = '';
      const neededMetrics = new Set();
      calculatorData.selectedSolutions.forEach(solution => {
        solution.metrics.forEach(metric => neededMetrics.add(metric));
      });
      if (neededMetrics.has('staffHours')) neededMetrics.add('hourlyRate');

      neededMetrics.forEach(metricKey => {
        const config = metricConfigs[metricKey];
        const sliderGroup = document.createElement('div');
        sliderGroup.className = 'slider-group';
        sliderGroup.innerHTML = `
          <div class="slider-header">
            <div class="slider-label">${config.label}</div>
            <div class="slider-value" id="${metricKey}Value">${config.format(config.default)}</div>
          </div>
          <input type="range" class="slider" id="${metricKey}Slider"
                 min="${config.min}" max="${config.max}" value="${config.default}" step="${config.step}">
          <div class="slider-range">
            <span>${config.format(config.min)}</span>
            <span>${config.format(config.max)}</span>
          </div>
        `;
        container.appendChild(sliderGroup);
        const slider = sliderGroup.querySelector('.slider');
        const valueDisplay = sliderGroup.querySelector('.slider-value');
        slider.addEventListener('input', (e) => {
          const value = parseInt(e.target.value);
          valueDisplay.textContent = config.format(value);
          calculatorData.metrics[metricKey] = value;
        });
      });
    }

    function nextStep() {
      // Validation for step 1
      if (currentStep === 1) {
        if (!calculatorData.propertyType || !calculatorData.propertySize) {
          showValidationError('Please select both property type and size');
          return;
        }
        populateSolutions();
      }

      // Validation for step 2
      if (currentStep === 2) {
        if (calculatorData.selectedSolutions.length === 0) {
          showValidationError('Please select at least one automation');
          return;
        }
        populateSliders();
      }

      // Navigate to next step
      if (currentStep < 4) {
        currentStep++;
        showStep(currentStep);
        updateProgress();
      }
    }

    function showValidationError(message) {
      // Create or update validation message element
      let errorEl = document.getElementById('validationError');
      if (!errorEl) {
        errorEl = document.createElement('div');
        errorEl.id = 'validationError';
        errorEl.style.cssText = `
          position: fixed;
          top: 20px;
          left: 50%;
          transform: translateX(-50%);
          background: rgba(255, 59, 48, 0.95);
          color: white;
          padding: 1rem 2rem;
          border-radius: 8px;
          font-weight: 600;
          z-index: 10000;
          animation: slideDown 0.3s ease;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        `;
        document.body.appendChild(errorEl);
      }

      errorEl.textContent = message;
      errorEl.style.display = 'block';

      // Auto-hide after 3 seconds
      setTimeout(() => {
        if (errorEl) {
          errorEl.style.animation = 'slideUp 0.3s ease';
          setTimeout(() => {
            if (errorEl && errorEl.parentNode) {
              errorEl.style.display = 'none';
            }
          }, 300);
        }
      }, 3000);
    }

    function prevStep() {
      if (currentStep > 1) {
        currentStep--;
        showStep(currentStep);
        updateProgress();
      }
    }

    function showStep(step) {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.getElementById(`step${step}`).classList.add('active');
      document.querySelectorAll('.step-indicator').forEach((s, i) => {
        s.classList.remove('active', 'completed');
        if (i + 1 < step) s.classList.add('completed');
        if (i + 1 === step) s.classList.add('active');
      });
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function updateProgress() {
      const progress = ((currentStep - 1) / 3) * 100;
      document.getElementById('progressFill').style.width = progress + '%';
    }

    function calculateResults() {
      const timeSolutions = calculatorData.selectedSolutions.filter(s => s.type === 'time');
      const revenueSolutions = calculatorData.selectedSolutions.filter(s => s.type === 'revenue');
      const conversionSolutions = calculatorData.selectedSolutions.filter(s => s.type === 'conversion');

      // Conservative time savings calculation with strong diminishing returns
      let totalTimeSavings = 0;
      if (timeSolutions.length > 0) {
        const sortedTimeSavings = timeSolutions.map(s => s.savings).sort((a, b) => b - a);
        sortedTimeSavings.forEach((saving, index) => {
          // Apply aggressive diminishing returns: 100%, 75%, 55%, 40%, 30%, etc.
          const multiplier = index === 0 ? 1 : Math.max(0.3, 1 - (index * 0.25));
          totalTimeSavings += saving * multiplier;
        });
        // Average and cap at 70% maximum time savings
        totalTimeSavings = Math.min(totalTimeSavings / timeSolutions.length, 70);
      }

      const weeklyCost = calculatorData.metrics.staffHours * calculatorData.metrics.hourlyRate;
      const annualCost = weeklyCost * 52;
      const savedHours = (calculatorData.metrics.staffHours * totalTimeSavings) / 100;
      const savedCost = (annualCost * totalTimeSavings) / 100;

      // More accurate revenue estimation
      let estimatedRevenue = annualCost * 5;
      if (calculatorData.metrics.rooms && calculatorData.metrics.averageRoomRate) {
        const avgOccupancy = calculatorData.metrics.occupancyRate / 100;
        estimatedRevenue = calculatorData.metrics.rooms * calculatorData.metrics.averageRoomRate * 365 * avgOccupancy;
      }

      // Revenue increase with very conservative caps and diminishing returns
      let totalRevenueIncrease = 0;
      if (revenueSolutions.length > 0) {
        const sortedRevenue = revenueSolutions.map(s => s.savings).sort((a, b) => b - a);
        sortedRevenue.forEach((saving, index) => {
          // Aggressive diminishing: 100%, 65%, 45%, 30%, etc.
          const multiplier = index === 0 ? 1 : Math.max(0.3, 1 - (index * 0.35));
          totalRevenueIncrease += saving * multiplier;
        });
        // Cap at 18% maximum - very conservative
        totalRevenueIncrease = Math.min(totalRevenueIncrease / revenueSolutions.length, 18);
      }

      // Conversion increase with very conservative scaling
      let totalConversionIncrease = 0;
      if (conversionSolutions.length > 0) {
        const sortedConversion = conversionSolutions.map(s => s.savings).sort((a, b) => b - a);
        sortedConversion.forEach((saving, index) => {
          // Very aggressive diminishing returns for conversion
          const multiplier = index === 0 ? 1 : Math.max(0.35, 1 - (index * 0.22));
          totalConversionIncrease += saving * multiplier;
        });
        // Scale down high percentages dramatically and cap at 10%
        totalConversionIncrease = Math.min((totalConversionIncrease / conversionSolutions.length) * 0.08, 10);
      }

      const additionalRevenue = (estimatedRevenue * totalRevenueIncrease) / 100;
      const conversionRevenue = (estimatedRevenue * totalConversionIncrease) / 100;
      const totalBenefit = savedCost + additionalRevenue + conversionRevenue;

      const setupCosts = { small: 3000, medium: 5000, large: 8000 };
      const setupCost = setupCosts[calculatorData.propertySize] || 5000;
      const monthsToROI = totalBenefit > 0 ? Math.ceil(setupCost / (totalBenefit / 12)) : 999;

      displayResults(totalBenefit, savedHours, monthsToROI, savedCost, additionalRevenue, conversionRevenue, totalTimeSavings, totalRevenueIncrease, totalConversionIncrease);
      nextStep();
    }

    function displayResults(totalBenefit, savedHours, monthsToROI, savedCost, additionalRevenue, conversionRevenue, avgTimeSavings, avgRevenueIncrease, avgConversionIncrease) {
      // Animate numbers counting up
      animateValue('totalBenefit', 0, Math.round(totalBenefit), 1500, true);
      animateValue('timeSaved', 0, Math.round(savedHours), 1200, false, ' hrs');
      animateValue('roiTimeline', 0, monthsToROI, 1000, false, ' mo');

      // Delay insights and chart for smooth sequential animation
      setTimeout(() => {
        generatePersonalizedExplanation(savedCost, additionalRevenue, conversionRevenue);
      }, 400);

      setTimeout(() => {
        generateInsights(savedCost, savedHours, avgTimeSavings, additionalRevenue, avgRevenueIncrease, conversionRevenue, avgConversionIncrease);
      }, 500);

      setTimeout(() => {
        createCharts(savedCost, additionalRevenue, conversionRevenue);
      }, 800);
    }

    function animateValue(elementId, start, end, duration, isCurrency = false, suffix = '') {
      const element = document.getElementById(elementId);
      const startTime = performance.now();
      const difference = end - start;

      function update(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);

        // Use easeOutExpo for smooth deceleration
        const easeOutExpo = progress === 1 ? 1 : 1 - Math.pow(2, -10 * progress);
        const current = Math.round(start + (difference * easeOutExpo));

        if (isCurrency) {
          element.textContent = 'Â£' + current.toLocaleString();
        } else {
          element.textContent = current + suffix;
        }

        if (progress < 1) {
          requestAnimationFrame(update);
        }
      }

      requestAnimationFrame(update);
    }

    function generatePersonalizedExplanation(savedCost, additionalRevenue, conversionRevenue) {
      const container = document.getElementById('personalizedExplanation');
      const propertyType = calculatorData.propertyType;
      const propertySize = calculatorData.propertySize;
      const selectedSolutions = calculatorData.selectedSolutions;

      const propertyLabels = {
        hotel: 'hotel',
        resort: 'resort',
        campsite: 'campsite',
        agency: 'travel agency'
      };

      const sizeLabels = {
        small: 'small',
        medium: 'medium-sized',
        large: 'large'
      };

      let explanationHTML = `
        <div class="explanation-intro">
          <p>Based on your <strong>${sizeLabels[propertySize]} ${propertyLabels[propertyType]}</strong> and the <strong>${selectedSolutions.length} automations</strong> you selected, here's why these results are achievable:</p>
        </div>
      `;

      // Cost savings explanation
      if (savedCost > 0) {
        const timeSolutions = selectedSolutions.filter(s => s.type === 'time');
        explanationHTML += `
          <div class="explanation-section">
            <h4><i class="fa-solid fa-coins"></i> Â£${Math.round(savedCost).toLocaleString()} Cost Savings</h4>
            <div class="explanation-list">
              <div class="explanation-item">
                <i class="fa-solid fa-check-circle"></i>
                <span>You selected <strong>${timeSolutions.length} time-saving automation(s)</strong>: ${timeSolutions.map(s => s.name).join(', ')}</span>
              </div>
              <div class="explanation-item">
                <i class="fa-solid fa-check-circle"></i>
                <span>These automations handle <strong>repetitive tasks 24/7</strong> - responding to guests, processing bookings, managing communications - tasks that currently take your staff hours each week</span>
              </div>
              <div class="explanation-item">
                <i class="fa-solid fa-check-circle"></i>
                <span>With <strong>AI voice agents and natural language processing</strong>, your team spends less time on admin and more time delivering exceptional guest experiences</span>
              </div>
            </div>
          </div>
        `;
      }

      // Revenue growth explanation
      if (additionalRevenue > 0) {
        const revenueSolutions = selectedSolutions.filter(s => s.type === 'revenue');
        explanationHTML += `
          <div class="explanation-section">
            <h4><i class="fa-solid fa-chart-line"></i> Â£${Math.round(additionalRevenue).toLocaleString()} Revenue Growth</h4>
            <div class="explanation-list">
              <div class="explanation-item">
                <i class="fa-solid fa-check-circle"></i>
                <span>You selected <strong>${revenueSolutions.length} revenue optimization automation(s)</strong>: ${revenueSolutions.map(s => s.name).join(', ')}</span>
              </div>
              <div class="explanation-item">
                <i class="fa-solid fa-check-circle"></i>
                <span>These systems use <strong>machine learning to analyze 80+ data points</strong> - competitor rates, local events, weather, booking patterns - adjusting pricing in real-time to maximize revenue</span>
              </div>
              <div class="explanation-item">
                <i class="fa-solid fa-check-circle"></i>
                <span>For a ${sizeLabels[propertySize]} ${propertyLabels[propertyType]}, even a <strong>small percentage increase compounds</strong> significantly over a full year</span>
              </div>
            </div>
          </div>
        `;
      }

      // Conversion boost explanation
      if (conversionRevenue > 0) {
        const conversionSolutions = selectedSolutions.filter(s => s.type === 'conversion');
        explanationHTML += `
          <div class="explanation-section">
            <h4><i class="fa-solid fa-bullseye"></i> Â£${Math.round(conversionRevenue).toLocaleString()} Conversion Boost</h4>
            <div class="explanation-list">
              <div class="explanation-item">
                <i class="fa-solid fa-check-circle"></i>
                <span>You selected <strong>${conversionSolutions.length} conversion-boosting automation(s)</strong>: ${conversionSolutions.map(s => s.name).join(', ')}</span>
              </div>
              <div class="explanation-item">
                <i class="fa-solid fa-check-circle"></i>
                <span>AI chatbots and booking assistants are available <strong>24/7 in 100+ languages</strong>, capturing inquiries during off-hours that would otherwise be lost</span>
              </div>
              <div class="explanation-item">
                <i class="fa-solid fa-check-circle"></i>
                <span>Personalized recommendations and <strong>instant responses (<1 minute)</strong> dramatically increase booking rates - HotelPlanner generated Â£150k in their first month with AI agents</span>
              </div>
            </div>
          </div>
        `;
      }

      container.innerHTML = explanationHTML;
    }

    function generateInsights(savedCost, savedHours, avgTimeSavings, additionalRevenue, avgRevenueIncrease, conversionRevenue, avgConversionIncrease) {
      const container = document.getElementById('insightsContainer');
      const insights = [];

      if (savedHours > 0) {
        const fte = savedHours / 40;
        insights.push({
          icon: 'fa-robot',
          text: `AI agents could save your team <strong>${Math.round(savedHours)} hours per week</strong>${fte >= 1 ? `, equivalent to ${fte.toFixed(1)} FTE(s)` : ''} with 80-95% automation of routine tasks in 100+ languages.`
        });
      }

      if (savedCost > 0) {
        insights.push({
          icon: 'fa-piggy-bank',
          text: `<strong>Â£${Math.round(savedCost).toLocaleString()} annual labor savings</strong> from ${Math.round(avgTimeSavings)}% automation with response times reduced from minutes to <1 minute.`
        });
      }

      if (additionalRevenue > 0) {
        insights.push({
          icon: 'fa-chart-line',
          text: `AI revenue agents analyzing 80+ data points could generate <strong>Â£${Math.round(additionalRevenue).toLocaleString()} additional revenue</strong> (${Math.round(avgRevenueIncrease)}% increase) through intelligent pricing optimization.`
        });
      }

      if (conversionRevenue > 0) {
        insights.push({
          icon: 'fa-bullseye',
          text: `24/7 AI booking agents with personalized recommendations could capture <strong>Â£${Math.round(conversionRevenue).toLocaleString()} additional revenue</strong> through improved conversion rates.`
        });
      }

      insights.push({
        icon: 'fa-globe',
        text: `Your AI agents work 24/7 in 100+ languages with 95% automation rate - HotelPlanner's AI agents generated Â£150k in their first month handling 40,000 inquiries.`
      });

      container.innerHTML = insights.map((insight, index) => `
        <div class="insight-item" style="opacity: 0; animation: fadeInUp 0.6s ease-out ${index * 0.15}s forwards;">
          <div class="insight-icon"><i class="fa-solid ${insight.icon}"></i></div>
          <div class="insight-text">${insight.text}</div>
        </div>
      `).join('');
    }

    function createCharts(savedCost, additionalRevenue, conversionRevenue) {
      createWaterfallChart(savedCost, additionalRevenue, conversionRevenue);
      createDonutChart(savedCost, additionalRevenue, conversionRevenue);
    }

    function createWaterfallChart(savedCost, additionalRevenue, conversionRevenue) {
      const canvas = document.getElementById('waterfallChart');
      if (!canvas) {
        console.error('Waterfall chart canvas not found');
        return;
      }

      const ctx = canvas.getContext('2d');
      if (!ctx) {
        console.error('Could not get canvas context');
        return;
      }

      // Destroy existing chart
      if (waterfallChart) {
        try {
          waterfallChart.destroy();
        } catch (e) {
          console.warn('Error destroying waterfall chart:', e);
        }
        waterfallChart = null;
      }

      const totalBenefit = savedCost + additionalRevenue + conversionRevenue;

      // Waterfall data: Initial (0), then each component, then total
      const data = [0, savedCost, additionalRevenue, conversionRevenue, totalBenefit];
      const labels = ['Start', 'Cost Savings', 'Revenue Growth', 'Conversion Boost', 'Total Benefit'];

      // Colors: transparent for start, green for savings, cyan for revenue, purple for conversion, green for total
      const backgroundColors = [
        'rgba(255, 255, 255, 0)',
        'rgba(29, 185, 84, 0.85)',
        'rgba(0, 210, 255, 0.85)',
        'rgba(97, 97, 255, 0.85)',
        'rgba(29, 185, 84, 0.95)'
      ];

      waterfallChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            data: data,
            backgroundColor: backgroundColors,
            borderColor: [
              'rgba(255, 255, 255, 0)',
              'rgba(29, 185, 84, 1)',
              'rgba(0, 210, 255, 1)',
              'rgba(97, 97, 255, 1)',
              'rgba(29, 185, 84, 1)'
            ],
            borderWidth: 2,
            borderRadius: 8,
            borderSkipped: false
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          aspectRatio: 2,
          plugins: {
            legend: { display: false },
            tooltip: {
              backgroundColor: 'rgba(24, 24, 24, 0.95)',
              titleColor: '#FFFFFF',
              bodyColor: '#FFFFFF',
              borderColor: '#1DB954',
              borderWidth: 2,
              padding: 16,
              cornerRadius: 8,
              titleFont: { size: 13, weight: 'bold' },
              bodyFont: { size: 15, weight: 'bold' },
              callbacks: {
                label: (context) => {
                  if (context.dataIndex === 0) return 'Starting Point';
                  return 'Â£' + Math.round(context.parsed.y).toLocaleString();
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                color: '#B3B3B3',
                font: { size: 12, family: "'Poppins', sans-serif" },
                callback: (value) => 'Â£' + (value / 1000).toFixed(0) + 'k'
              },
              grid: {
                color: 'rgba(255, 255, 255, 0.06)',
                drawBorder: false
              },
              border: { display: false }
            },
            x: {
              ticks: {
                color: '#FFFFFF',
                font: { size: 11, weight: '600', family: "'Poppins', sans-serif" }
              },
              grid: { display: false },
              border: { display: false }
            }
          },
          animation: {
            duration: 2000,
            easing: 'easeInOutCubic',
            delay: (context) => context.dataIndex * 150
          }
        }
      });
    }

    function createDonutChart(savedCost, additionalRevenue, conversionRevenue) {
      const canvas = document.getElementById('donutChart');
      if (!canvas) {
        console.error('Donut chart canvas not found');
        return;
      }

      const ctx = canvas.getContext('2d');
      if (!ctx) {
        console.error('Could not get canvas context');
        return;
      }

      // Destroy existing chart
      if (donutChart) {
        try {
          donutChart.destroy();
        } catch (e) {
          console.warn('Error destroying donut chart:', e);
        }
        donutChart = null;
      }

      const data = [];
      const labels = [];
      const colors = [];

      if (savedCost > 0) {
        data.push(savedCost);
        labels.push('Cost Savings');
        colors.push('rgba(29, 185, 84, 0.9)');
      }
      if (additionalRevenue > 0) {
        data.push(additionalRevenue);
        labels.push('Revenue Growth');
        colors.push('rgba(0, 210, 255, 0.9)');
      }
      if (conversionRevenue > 0) {
        data.push(conversionRevenue);
        labels.push('Conversion Boost');
        colors.push('rgba(97, 97, 255, 0.9)');
      }

      donutChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: labels,
          datasets: [{
            data: data,
            backgroundColor: colors,
            borderColor: '#021B23',
            borderWidth: 3,
            hoverBorderColor: '#FFFFFF',
            hoverBorderWidth: 4,
            hoverOffset: 8
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          aspectRatio: 1.2,
          cutout: '65%',
          plugins: {
            legend: {
              display: true,
              position: 'bottom',
              labels: {
                color: '#FFFFFF',
                font: { size: 12, weight: '600', family: "'Poppins', sans-serif" },
                padding: 15,
                usePointStyle: true,
                pointStyle: 'circle'
              }
            },
            tooltip: {
              backgroundColor: 'rgba(24, 24, 24, 0.95)',
              titleColor: '#FFFFFF',
              bodyColor: '#FFFFFF',
              borderColor: '#1DB954',
              borderWidth: 2,
              padding: 16,
              cornerRadius: 8,
              titleFont: { size: 13, weight: 'bold' },
              bodyFont: { size: 15, weight: 'bold' },
              callbacks: {
                label: (context) => {
                  const value = 'Â£' + Math.round(context.parsed).toLocaleString();
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = ((context.parsed / total) * 100).toFixed(1);
                  return `${context.label}: ${value} (${percentage}%)`;
                }
              }
            }
          },
          animation: {
            duration: 1500,
            easing: 'easeInOutQuart',
            animateRotate: true,
            animateScale: true
          }
        }
      });
    }

    function resetCalculator() {
      // Destroy charts to prevent memory leaks
      if (waterfallChart) {
        try {
          waterfallChart.destroy();
        } catch (e) {
          console.warn('Error destroying waterfall chart:', e);
        }
        waterfallChart = null;
      }

      if (donutChart) {
        try {
          donutChart.destroy();
        } catch (e) {
          console.warn('Error destroying donut chart:', e);
        }
        donutChart = null;
      }

      // Reset calculator data
      calculatorData.propertyType = null;
      calculatorData.propertySize = null;
      calculatorData.selectedSolutions = [];
      calculatorData.metrics = {
        staffHours: 40,
        hourlyRate: 15,
        emailsPerDay: 100,
        rooms: 50,
        averageRoomRate: 100,
        occupancyRate: 70
      };

      // Reset UI
      currentStep = 1;
      showStep(1);
      updateProgress();

      // Clear selections
      document.querySelectorAll('.property-card').forEach(c => c.classList.remove('selected'));
      document.querySelectorAll('.solution-card').forEach(c => c.classList.remove('selected'));

      // Clear tooltips
      const existingTooltips = document.querySelectorAll('.tooltip-card');
      existingTooltips.forEach(t => t.remove());

      // Scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  </script>
